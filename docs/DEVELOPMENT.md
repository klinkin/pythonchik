# Руководство по разработке Pythonchik

## Содержание
- [Руководство по разработке Pythonchik](#руководство-по-разработке-pythonchik)
  - [Содержание](#содержание)
  - [Введение](#введение)
  - [Рефакторинг и организация кода](#рефакторинг-и-организация-кода)
    - [Исходная структура](#исходная-структура)
    - [Новая архитектура](#новая-архитектура)
  - [Управление зависимостями с Poetry](#управление-зависимостями-с-poetry)
    - [Установка Poetry](#установка-poetry)
    - [Основные команды](#основные-команды)
    - [Структура pyproject.toml](#структура-pyprojecttoml)
  - [Инструменты разработки](#инструменты-разработки)
    - [Форматирование кода](#форматирование-кода)
    - [Проверка типов](#проверка-типов)
    - [Pre-commit хуки](#pre-commit-хуки)
  - [Тестирование](#тестирование)
    - [Структура тестов](#структура-тестов)
    - [Запуск тестов](#запуск-тестов)
    - [Добавление тестов](#добавление-тестов)
  - [Сборка приложения](#сборка-приложения)
    - [Для Windows](#для-windows)
    - [Для macOS](#для-macos)
  - [Компоненты пользовательского интерфейса](#компоненты-пользовательского-интерфейса)
    - [Архитектура UI](#архитектура-ui)
  - [Миграция основного функционала](#миграция-основного-функционала)

## Введение

Проект Pythonchik прошел путь от монолитного скрипта `main_original.py` до современного, хорошо структурированного приложения с графическим интерфейсом. В этом руководстве мы рассмотрим все аспекты проделанной работы по рефакторингу и организации процесса разработки.

## Рефакторинг и организация кода

### Исходная структура

Изначально весь код находился в одном файле `main_original.py`, что затрудняло его поддержку и развитие. Основные проблемы включали:

- Смешивание логики UI и бизнес-логики
- Отсутствие обработки ошибок
- Сложность добавления новых функций
- Отсутствие тестов

### Новая архитектура

Проект был реорганизован по следующим принципам:

1. **Модульная структура**:
   ```
   pythonchik/
   ├── __init__.py
   ├── main.py           # Точка входа
   ├── config.py         # Конфигурация
   ├── services.py       # Бизнес-логика
   ├── types.py          # Типы данных
   ├── ui/               # Компоненты интерфейса
   └── utils/            # Вспомогательные функции
   ```

2. **Разделение ответственности**:
   - UI компоненты отделены от бизнес-логики
   - Утилиты вынесены в отдельные модули
   - Конфигурация централизована

3. **Типизация**:
   - Добавлены аннотации типов
   - Настроена проверка типов с помощью mypy

4. **Обработка ошибок**:
   - Добавлен централизованный обработчик ошибок
   - Улучшена обратная связь для пользователя

## Управление зависимостями с Poetry

### Установка Poetry

```bash
curl -sSL https://install.python-poetry.org | python3 -
```

### Основные команды

```bash
# Установка зависимостей
poetry install

# Добавление новой зависимости
poetry add package_name

# Добавление dev-зависимости
poetry add --group dev package_name

# Обновление зависимостей
poetry update
```

### Структура pyproject.toml

Файл `pyproject.toml` содержит:

- Метаданные проекта
- Зависимости приложения
- Dev-зависимости
- Настройки инструментов

## Инструменты разработки

### Форматирование кода

1. **Black**
   - Автоматическое форматирование кода
   - Настроен на длину строки 110 символов

   ```bash
   poetry run black pythonchik
   ```

2. **Ruff**
   - Быстрый линтер и форматер
   - Проверяет множество стилистических правил

   ```bash
   poetry run ruff check pythonchik
   poetry run ruff format pythonchik
   ```

### Проверка типов
**MyPy**
- Статический анализатор типов
- Строгие настройки проверки
```bash
poetry run mypy pythonchik
```

### Pre-commit хуки
Настроены автоматические проверки при коммите:
- Проверка синтаксиса
- Форматирование кода
- Проверка типов

Установка:
```bash
poetry run pre-commit install
```

## Тестирование

### Структура тестов
```
tests/
├── test_app.py         # Тесты UI
├── test_services.py    # Тесты бизнес-логики
├── test_utils.py       # Тесты утилит
└── test_data/         # Тестовые данные
```

### Запуск тестов
```bash
# Запуск всех тестов
poetry run pytest

# Запуск с отчетом о покрытии
poetry run pytest --cov pythonchik
```

### Добавление тестов
1. Создайте новый файл test_*.py
2. Используйте классы TestSuite* для группировки тестов
3. Добавьте тестовые данные в test_data/

## Сборка приложения

### Для Windows
```bash
make exe
```

### Для macOS
```bash
make app
```

Сборка создает автономное приложение со всеми зависимостями.

## Компоненты пользовательского интерфейса

### Архитектура UI
Интерфейс приложения построен на основе фреймов, что обеспечивает модульность и простоту расширения:

1. **SideBarFrame** - навигационная панель:
   - Управление режимами работы
   - Переключение между разделами
   - Настройки темы

2. **ActionMenuFrame** - панель действий:
   - Кнопки для выполнения операций
   - Настройки текущего режима
   - Обработка пользовательского ввода

3. **ResultFrame** - область результатов:
   - Отображение результатов операций
   - Визуализация данных
   - Интерактивные элементы

4. **LogFrame** - панель логов:
   - Отображение статуса операций
   - История действий
   - Сообщения об ошибках

## Миграция основного функционала

Все основные функции из оригинального `main_original.py` были успешно перенесены и улучшены в новой архитектуре:

1. **Извлечение адресов**
   - **Было**: Прямая обработка в main_original.py
   - **Стало**: `services.py: extract_addresses`
   - Улучшения: Добавлена валидация, обработка ошибок, поддержка различных форматов

2. **Сжатие изображений**
   - **Было**: Базовое сжатие в основном скрипте
   - **Стало**: `ui/app.py: compress_images`
   - Улучшения: Оптимизация качества, поддержка разных форматов

3. **Подсчет уникальных предложений**
   - **Было**: Простой подсчет в основном скрипте
   - **Стало**: `services.py: count_unique_offers`
   - Улучшения: Дедупликация, фильтрация, агрегация

4. **Создание тестового JSON**
   - **Было**: Хардкод в main_original.py
   - **Стало**: `services.py: create_test_json`
   - Улучшения: Гибкая генерация, валидация схемы

5. **Конвертация форматов изображений**
   - **Было**: Базовая конвертация в main_original.py
   - **Стало**: `ui/app.py: convert_image_format`
   - Улучшения: Поддержка всех популярных форматов, сохранение качества

6. **Сравнение цен**
   - **Было**: Простое сравнение в основном скрипте
   - **Стало**: `services.py: analyze_price_differences`
   - Улучшения: Анализ трендов, форматирование вывода

Каждая функция была не только перенесена, но и значительно улучшена с точки зрения надежности, производительности и удобства использования. Добавлена обработка ошибок, логирование и тестовое покрытие.
